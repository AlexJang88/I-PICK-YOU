<!DOCTYPE html>
<html lang="en"
      class="light-style layout-menu-fixed"
      dir="ltr"
      data-theme="theme-default"
      data-assets-path="../assets/"
      data-template="vertical-menu-template-free"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>계약서</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/img/favicon/favicon.ico}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />

    <!-- Icons. Uncomment required icon fonts -->
    <link th:href="@{/assets/vendor/fonts/boxicons.css}" rel="stylesheet" />

    <!-- Core CSS -->
    <link th:href="@{/assets/vendor/css/core.css}" rel="stylesheet" class="template-customizer-core-css" />
    <link th:href="@{/assets/vendor/css/theme-default.css}" rel="stylesheet" class="template-customizer-theme-css" />
    <link th:href="@{/assets/css/demo.css}" rel="stylesheet" />

    <!-- Vendors CSS -->
    <link th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" rel="stylesheet" />

    <!-- Helpers -->
    <script th:src="@{/assets/vendor/js/helpers.js}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script th:src="@{/assets/js/config.js}"></script>
    <script th:src="@{https://code.jquery.com/jquery-3.6.0.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        body {
        font-family: Arial, sans-serif;
        }
        .container {
        width: 70%;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid black;
        }
        .title-custom {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        }
        .content-custom {
        font-size: 14px;
        }
        .content-custom table {
        width: 100%;
        border-collapse: collapse;
        }
        .content-custom td, .content-custom th {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
        }
        .content-custom th {
        background-color: #f2f2f2;
        }
        .content-custom input[type="text"], .content-custom input[type="date"] {
        width: 100%;
        border: none;
        border-bottom: 1px solid black;
        padding: 5px;
        outline: none;
        }
        .inline-input {
        border: none;
        border-bottom: 1px solid black;
        padding: 5px;
        outline: none;
        display: inline-block;
        width: auto;
        min-width: 100px;
        }
        h3{
        text-align : center;
        }
        h4{
        text-align:center;
        }
        .wrapper-custom {
        position: relative;
        width: 400px;
        height: 200px;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
        }

        .signature-pad {
        position: absolute;
        left: 0;
        top: 0;
        width: 400px;
        height: 200px;
        background-color: white;
        }
         .modal-content-custom button {
        width: 400px;  /* 버튼 길이를 canvas 길이에 맞춤 */
        margin-top: 10px;  /* 약간의 여백 추가 */
    }
        .text-right {
                text-align: right;
            }
        .text {
        font-size: 30px;
        margin-top: 70px;
        vertical-align: middle;
        display: block; /* Initially visible */
        }

        #img01, #img02 {
        text-align: center;
        width: 150px;
        height: 75px;
        display: none;
        }
        .modal-custom {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
        }
        .modal-content-custom {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 30%;
        box-shadow: 0 3px 7px rgba(0,0,0,.3);
        text-align: center;
        }
        .close-custom {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        }
        .close-custom:hover,
        .close-custom:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
        }
    </style>
</head>

<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <!-- Menu -->
        <div th:include="~{design/side-bar :: side}"></div>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
            <!-- Navbar -->


            <div th:insert="~{design/navi-bar :: navi}"></div>


            <!-- / Navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->
                <div class="container-fluid flex-grow-1 container-p-y">
                    <!-- Layout Demo -->
                    <div class="content-custom">
                        <div class="modal" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" style="display: none;" sec:authorize="isAuthenticated()">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">Chat</h4>
                                    </div>
                                    <div class="modal-body">
                                        <iframe id="roomFrame" width="100%" height="500px" frameborder="0"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="title-custom">건설일용근로자 표준근로계약서</div><div class="text-right"><a th:if="${PDF==1}" th:href="'/upload/contract/' + ${contract.id} + '/' + ${#temporals.format(contract.contractDate, 'yyyy-MM-dd') + '.pdf'}">계약서 PDF로 보기</a></div>
                        <div class="content-custom">
                            <p> <span th:text="${company.companyInfo.name}"></span> (이하 "사업주"라 함)과(와) <span th:text="${member.memberInfo.name}"></span> (이하 "근로자"라 함)는 다음과 같이 근로계약을 체결한다.</p>
                            <table>
                                <tr>
                                    <th>1. 근로계약기간</th>
                                    <td>
                                        <span th:text="${#temporals.format(contract.startDate, 'yyyy')}"></span>년
                                        <span th:text="${#temporals.format(contract.startDate, 'MM')}"></span>월
                                        <span th:text="${#temporals.format(contract.startDate, 'dd')}"></span>일
                                        부터
                                        <span th:text="${#temporals.format(contract.endDate, 'yyyy')}"></span>년
                                        <span th:text="${#temporals.format(contract.endDate, 'MM')}"></span>월
                                        <span th:text="${#temporals.format(contract.endDate, 'dd')}"></span>일 까지
                                        <br> ※ 근로계약기간을 정하지 않는 경우에는 "근로개시일"만 기재
                                    </td>
                                </tr>
                                <tr>
                                    <th>2. 근 무 장 소</th>
                                    <td><span th:text="${contract.location}"></span></td>
                                </tr>
                                <tr>
                                    <th>3. 업무의 내용(직종)</th>
                                    <td><span th:text="${contract.job}"></span></td>
                                </tr>
                                <tr>
                                    <th>4. 소정근로시간</th>
                                    <td><span th:text="${#strings.substring(contract.workStartTime,0,5)}"></span>부터 <span th:text="${#strings.substring(contract.workStartTime,0,5)}"></span>까지 </td>
                                </tr>
                                <tr>
                                    <th>5. 근무일/휴일</th>
                                    <td>매주 <span th:text="${contract.worksSchedule}"></span>일(또는 매일단위)근무 <br> ※ 주휴일은 1주간 소정근로일을 모두 근로한 경우에 주당 1일을 유급으로 부여</td>
                                </tr>
                                <tr>
                                    <th>6. 임 금</th>
                                    <td>
                                        <p>- <span th:text="${contract.wageType}"></span>금: <span th:text="${contract.wage}"></span>원</p>
                                        <p>- 기타 제수당(시간외근로수당, 야간·휴일근로수당 등): <span th:text="${contract.etc}"></span></p>
                                        <p>- 임금지급일: <span th:text="${contract.payDate}"> </span><span th:text="${contract.customPayDate}">일(휴일의 경우는 전일 지급)</span></p>
                                        <p>- 지급방법: <span th:text="${contract.wageInto}"></span></p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>7. 연차유급휴가</th>
                                    <td>연차유급휴가는 근로기준법에서 정하는 바에 따라 부여함</td>
                                </tr>
                                <tr>
                                    <th>8. 사회보험 적용여부</th>
                                    <td>
                                        <p>□ 고용보험(<span th:if="${contract.insurance1=='없음'}" >해당없음</span><span th:unless="${contract.insurance1=='없음'}" >해당</span>)
                                            □ 산재보험(<span th:if="${contract.insurance2=='없음'}" >해당없음</span><span th:unless="${contract.insurance2=='없음'}" >해당</span>)
                                            □ 국민연금(<span th:if="${contract.insurance3=='없음'}" >해당없음</span><span th:unless="${contract.insurance3=='없음'}" >해당</span>)
                                            □ 건강보험(<span th:if="${contract.insurance4=='없음'}" >해당없음</span><span th:unless="${contract.insurance4=='없음'}" >해당</span>)</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>9. 근로계약서 교부</th>
                                    <td>사업주는 근로계약을 체결함과 동시에 본 계약서를 사본하여 "근로자"의 교부요구와 관계없이 "근로자"에게 교부함(근로기준법 제17조 이행)</td>
                                </tr>
                                <tr>
                                    <th>10. 근로계약, 취업규칙 등의 성실한 이행의무</th>
                                    <td>사업주와 근로자는 각각 근로계약, 취업규칙, 단체협약을 지키고 성실하게 이행하여야 함</td>
                                </tr>
                                <tr>
                                    <th>11. 기 타</th>
                                    <td>이 계약에 정함이 없는 사항은 근로기준법령에 의함</td>
                                </tr>
                            </table>
                            <br>
                            <h3><span th:text="${#temporals.format(contract.contractDate, 'yyyy')}"></span>년
                                <span th:text="${#temporals.format(contract.contractDate, 'MM')}"></span>월
                                <span th:text="${#temporals.format(contract.contractDate, 'dd')}"></span>일</h3>
                            <h4>사업주 </h4>
                            <h4>사업체 명 : <span th:text="${company.companyInfo.companyName}"> </span> (전화: <span th:text="${company.phone}"> </span>)</h4>
                            <h4>주소: <span th:text="${company.address}"> </span></h4>
                            <h4>대표자: <span th:text="${company.companyInfo.name}"> </span><img src="" id="img01"/></h4>
                            <h4>근로자 </h4>
                            <h4>연락처 : <span th:text="${member.phone}"> </span></h4>
                            <h4>주소: <span th:text="${member.address}"> </span></h4>
                            <h4>성 함: <span th:text="${member.memberInfo.name}"> </span><img src="" id="img02"/></h4>
                            <input type="hidden" id="signCheck" th:value=${signCheck}>
                            <input type="hidden" id="comSign" th:value="${comSign}">
                            <input type="hidden" id="memSign" th:value="${memSign}">
                            <br>
                            <input type="hidden" name="contractId" id="contractId" th:value="${contract.id}">
                            <p style="text-align: center;">
                                <button id="signButton" >서명하기</button>
                            </p>
                            <div class="modal-custom" id="signatureModal">
                                <div class="modal-content-custom">
                                    <span class="close-custom">&times;</span>
                                    <div class="wrapper-custom">
                                        <canvas id="signature-pad" class="signature-pad" width=400 height=200></canvas>
                                    </div>
                                    <button id="save-png">저장</button>
                                    <button id="clear">다시쓰기</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- / Content -->
                <script>
                    $(function () {
                     window.addEventListener('message', event => {
                                       if (event.origin !== 'http://localhost:4000') return;  // 보안 검사
                                       if (event.data === 'modalClosed') {
                                           $('#myModal').modal('hide');
                                             $('#chatModal').modal('hide');// 모달이 닫힌 후 동작 수행
                                       }
                                       });
                       var canvas = document.getElementById('signature-pad');
                       var signaturePad = new SignaturePad(canvas, {
                           backgroundColor: 'rgb(255, 255, 255, 0)',
                           penColor: "rgb(1, 2, 3)"
                       });

                        var signCheck = $('#signCheck').val();
                        var comSign = $('#comSign').val();
                        var memSign = $('#memSign').val();

                       if (signCheck == '11') {
                        $("#img01").attr('src', $('#comSign').val()).show();
                        $('#signButton').hide();
                        $('#save-png').hide();
                        $('#clear').hide();
                        }else if (signCheck == '12') {
                        $("#img02").attr('src', $('#memSign').val()).show();
                        $('#signButton').show();
                        $('#save-png').hide();
                        $('#clear').hide();
                    }else if (signCheck == '21') {
                        $("#img02").attr('src', $('#memSign').val()).show();
                        $('#signButton').hide();
                        $('#save-png').hide();
                        $('#clear').hide();
                    }else if (signCheck == '22') {
                        $("#img01").attr('src', $('#comSign').val()).show();
                        $('#signButton').show();
                        $('#save-png').hide();
                        $('#clear').hide();
                    }else if (signCheck == '100') {
                        $("#img01").attr('src', $('#comSign').val()).show();
                        $("#img02").attr('src', $('#memSign').val()).show();
                        $('#signButton').hide();
                        $('#save-png').hide();
                        $('#clear').hide();
                    }

                       document.getElementById('signButton').addEventListener('click', function () {
                           $('#signatureModal').show();
                            $('#save-png').show();
                             $('#clear').show();
                       });

                       document.getElementById('save-png').addEventListener('click', function () {
                           if (signaturePad.isEmpty()) {
                               return alert("Please provide a signature first.");
                           }

                           var dataURL = signaturePad.toDataURL('image/png');
                           var blob = dataURLToBlob(dataURL);
                           var formData = new FormData();
                           formData.append("signature", blob, "signature.png");
                           formData.append("contractId", document.getElementById('contractId').value);
                           $.ajax({
                               url: '/recruit/saveSignature',
                               type: 'POST',
                               data: formData,
                               processData: false,
                               contentType: false,
                               success: function (response) {
                                   $('.wrapper-custom').hide();
                                   $('#save-png').hide();
                                   $('#clear').hide();
                                   $('#signButton').hide();
                                   location.reload();
                               },
                               error: function (error) {
                               }
                           });
                       });

                       document.querySelector('.close-custom').addEventListener('click', function () {
                           $('#signatureModal').hide();
                       });

                       document.getElementById('clear').addEventListener('click', function () {
                           signaturePad.clear();
                       });

                       function dataURLToBlob(dataURL) {
                           var binary = atob(dataURL.split(',')[1]);
                           var array = [];
                           for (var i = 0; i < binary.length; i++) {
                               array.push(binary.charCodeAt(i));
                           }
                           return new Blob([new Uint8Array(array)], { type: 'image/png' });
                       }
                   });
                </script>
                <!-- Footer -->
                <div th:include="~{design/footer :: footer}"></div>
                <!-- / Footer -->

                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
</div>
<!-- / Layout wrapper -->



<!-- Core JS -->
<!-- build:js assets/vendor/js/core.js -->
<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
<script th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

<script th:src="@{/assets/vendor/js/menu.js}"></script>
<!-- endbuild -->

<!-- Vendors JS -->

<!-- Main JS -->
<script th:src="@{/assets/js/main.js}"></script>

<!-- Page JS -->

<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
</body>
</html>